<?php
$nc_comments = new nc_comments($cc);
$ignore_all = 1;
$query_select = "a.*, DATE_FORMAT(a.`Date`,'%Y') as Date_year, DATE_FORMAT(a.`Date`,'%m') as Date_month,
    DATE_FORMAT(a.`Date`,'%d') as Date_day, DATE_FORMAT(a.`Date`,'%H') as Date_hours, DATE_FORMAT(a.`Date`,'%i') as Date_minutes, DATE_FORMAT(a.`Date`,'%s') as Date_seconds";
$query_from = "Comments_Count cc";
$query_join = " LEFT JOIN Message2000 a ON cc.Message_ID = a.Message_ID";
if ($current_sub['Subdivision_ID'] == 3 || $current_sub['Subdivision_ID'] == 1) {
    $subs_arr = nc_get_sub_children('14');
    $subs = nc_array_to_string($subs_arr,array('element' => '%ELEMENT','divider' => ','));
    $query_where = "a.Subdivision_ID NOT IN(20,117,118,14, " . $subs . ") AND NOW() >= Date";
} elseif ($current_sub['Subdivision_ID'] == 14) {
    $subs_arr = nc_get_sub_children('14');
    $subs = nc_array_to_string($subs_arr,array('element' => '%ELEMENT','divider' => ','));
    $ignore_sub=$ignore_cc=1;
    $query_where .= "a.Subdivision_ID IN($subs)";
} elseif ($current_sub['Subdivision_ID'] == 41) {
    $subs_arr = nc_get_sub_children('41');
    $subs = nc_array_to_string($subs_arr,array('element' => '%ELEMENT','divider' => ','));
    $ignore_sub=$ignore_cc=1;
    $query_where .= "a.Subdivision_ID IN($subs)";
} else {
    $query_where .= "a.Subdivision_ID = " . $s_type;
}

$query_order = "(cc.CountComments + cc.CountReplies) DESC";
$query_limit = $recNum;

?>